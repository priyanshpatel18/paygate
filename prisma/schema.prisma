generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  privyId       String    @unique
  primaryWallet String?
  email         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  apis          Api[]
  wallets       Wallet[]

  @@index([privyId])
  @@index([primaryWallet])
}

model Wallet {
  id               String   @id @default(cuid())
  address          String   @unique
  chainType        String   // "solana", "ethereum", etc.
  walletClientType String?  // "Backpack", "privy", etc.
  connectorType    String?  // "solana_adapter", "embedded", etc.
  firstVerifiedAt  DateTime?
  latestVerifiedAt DateTime?
  isPrimary        Boolean  @default(false)
  
  userId           String
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([userId])
  @@index([address])
  @@index([isPrimary])
}

model Api {
  id              String   @id @default(cuid())
  name            String
  description     String?
  endpoint        String
  originalUrl     String
  wrappedUrl      String   @unique
  pricePerRequest Float    @default(0.01)
  status          String   @default("active")
  totalRequests   Int      @default(0)
  successRequests Int      @default(0)
  totalRevenue    Float    @default(0)
  
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([wrappedUrl])
  @@index([status])
}